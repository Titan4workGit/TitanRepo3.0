(function(_0x4cb454,_0x364cd1){var _0x299edf=a0_0x2935,_0x5152b2=_0x4cb454();while(!![]){try{var _0x330cbe=-parseInt(_0x299edf(0x134))/0x1*(-parseInt(_0x299edf(0xf3))/0x2)+-parseInt(_0x299edf(0xff))/0x3+parseInt(_0x299edf(0xf9))/0x4*(-parseInt(_0x299edf(0xf6))/0x5)+-parseInt(_0x299edf(0xe8))/0x6*(parseInt(_0x299edf(0x131))/0x7)+parseInt(_0x299edf(0x103))/0x8+-parseInt(_0x299edf(0x132))/0x9*(-parseInt(_0x299edf(0x102))/0xa)+-parseInt(_0x299edf(0x137))/0xb*(-parseInt(_0x299edf(0x10d))/0xc);if(_0x330cbe===_0x364cd1)break;else _0x5152b2['push'](_0x5152b2['shift']());}catch(_0x3c65dc){_0x5152b2['push'](_0x5152b2['shift']());}}}(a0_0xfe95,0x94d9a));const selectedFolders=[];var zip,listName='DemoLibrary';const myTimeout='';var messagetext='',Ismessage=![],IsleftRestritcfile=![];function a0_0x2935(_0xcd928b,_0x423a7a){var _0xfe952=a0_0xfe95();return a0_0x2935=function(_0x2935e6,_0x3c0b71){_0x2935e6=_0x2935e6-0xe5;var _0x1ce6c8=_0xfe952[_0x2935e6];return _0x1ce6c8;},a0_0x2935(_0xcd928b,_0x423a7a);}async function downloadSelectedFilesAsZip(_0x19beb1){var _0x1dd870=a0_0x2935;$['getScript'](_0x1dd870(0xf0),function(){var _0x63c25a=_0x1dd870;_0x19beb1[0x0][_0x63c25a(0xfb)]==undefined?(listName=_0x19beb1[0x0][_0x63c25a(0x105)],SiteUrl=_0x19beb1[0x0][_0x63c25a(0x11a)]):listName=_0x19beb1[0x0][_0x63c25a(0xfb)];var _0x58eea5=[];Ismessage=![],messagetext='';var _0x297efe=_0x19beb1[_0x63c25a(0xea)](function(_0x4a4d5e){var _0x248a0e=_0x63c25a;_0x4a4d5e['IsBlock']!='Yes'?_0x4a4d5e[_0x248a0e(0x122)]==undefined?$[_0x248a0e(0x142)](getFolderFilesAndSubFolders(_0x4a4d5e[_0x248a0e(0xe7)],_0x58eea5))[_0x248a0e(0x10b)](function(_0x54b0c0){return _0x297efe=_0x54b0c0;}):$[_0x248a0e(0x142)](getFolderFilesAndSubFolders(_0x4a4d5e[_0x248a0e(0x122)],_0x58eea5))['done'](function(_0x1def7c){return _0x297efe=_0x1def7c;}):(Ismessage=!![],messagetext=_0x248a0e(0xf4));}),_0xe0ee17='';_0x58eea5['length']>0x0?Promise['all'](_0x297efe)[_0x63c25a(0x116)](function(){var _0x10a1c6=_0x63c25a;zip=new JSZip();var _0x143e96=_0x58eea5[_0x10a1c6(0xea)](function(_0x4c0494){var _0x4cb5c3=_0x10a1c6,_0x171379=_spPageContextInfo[_0x4cb5c3(0x100)]+_0x4c0494;return fetch(_0x171379)['then'](function(_0x210127){var _0xba2c05=_0x4cb5c3;if(!_0x210127['ok'])throw new Error(_0xba2c05(0x110));return _0x210127['blob']();})[_0x4cb5c3(0x116)](function(_0x45bef3){var _0x534613=_0x4cb5c3,_0x226f73=_0x4c0494[_0x534613(0xfc)](_0x4c0494['indexOf'](listName)+listName[_0x534613(0x13d)]+0x1);zip[_0x534613(0x141)](_0x226f73,_0x45bef3);})[_0x4cb5c3(0x106)](_0x1f32f2=>{var _0x5d9706=_0x4cb5c3;console['error'](_0x5d9706(0x135),_0x1f32f2);});});Promise[_0x10a1c6(0x104)](_0x143e96)[_0x10a1c6(0x116)](function(){dowloadZip();});}):(Ismessage?alert(messagetext):alert(_0x63c25a(0xfa)),IsleftRestritcfile=![],waitingDialog[_0x63c25a(0x138)]());});}function a0_0xfe95(){var _0x296a93=['href','17087hcQZpL','459KyXpYt','<input\x20type=\x27checkbox\x27\x20name=\x27files\x27\x20value=\x27','1eaPNTB','There\x20was\x20a\x20problem\x20with\x20the\x20fetch\x20operation:','/_api/web/lists/getbytitle(\x27','22rhPycM','hide','ajax','resolve','forEach','reject','length','openItems','Restricted\x20file(s)\x20are\x20skipped\x20to\x20download','skiptoken=','file','when','stringify','</td></tr>','ServerURL','2466shOQYJ','Files','map','&$filter=FileDirRef\x20eq\x20\x27','log','__next','promise','Deferred','https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js','<table>','name','1509626oeuVgD','\x20Files/folders\x20with\x20restricted\x20view\x20permission\x20can\x27t\x20be\x20downloaded.','push','934405OeFoYU','fail','concat','12oEITKy','This\x20is\x20an\x20empty\x20folder\x20&\x20can\x27t\x20be\x20downloaded.','SelectedLibrary','substring','apply','click','1253745FZroKK','portalUrl','html','115730AgbQmh','9266520JpPAbh','all','LibraryName','catch','/_api/web/GetFolderByServerRelativeUrl(\x27','&$skiptoken=','application/json;\x20odata=verbose','FileRef','done','#fileList','528888WnytDm','Folders','BasePermissions','Network\x20response\x20was\x20not\x20ok','\x27)/GetFolderByServerRelativeUrl(\x27','GET','#overlaysearch','download','\x27)?$expand=Folders,Files,\x20ListItemAllFields/EffectiveBasePermissions,\x20Files/ListItemAllFields/EffectiveBasePermissions','then','.chkShareToMe','</table>','files_','SiteURL','\x27)/folders','results','<tr><td>','createObjectURL','/_api/web/lists/getByTitle(\x27DemoLibrary\x27)/items?$select=FileRef&$orderby=FileLeafRef&$filter=FSObjType\x20eq\x201','toJSON','application/json;odata=verbose','fileserverrelativeurl','ListItemAllFields','fadeIn','blob','webAbsoluteUrl','ServerRelativeUrl','indexOf','createElement','PermissionKind','/_api/web/GetFolderByServerRelativePath(\x27','prop','checkbox','checked','\x27)/items?$top=5000'];a0_0xfe95=function(){return _0x296a93;};return a0_0xfe95();}function dowloadZip(){var _0x30b03f=a0_0x2935;zip['generateAsync']({'type':_0x30b03f(0x125)})[_0x30b03f(0x116)](function(_0x13c9ef){var _0x341cd2=_0x30b03f,_0x11f0e0=document[_0x341cd2(0x129)]('a');_0x11f0e0[_0x341cd2(0x130)]=URL[_0x341cd2(0x11e)](_0x13c9ef),_0x11f0e0[_0x341cd2(0x114)]=_0x341cd2(0x119)+new Date()[_0x341cd2(0x120)]()['slice'](0x0,0x14)+'.zip',_0x11f0e0[_0x341cd2(0xfe)](),waitingDialog[_0x341cd2(0x138)](),IsleftRestritcfile&&(alert(_0x341cd2(0x13f)),IsleftRestritcfile=![]),$('.chkFileFolder')['prop']('checked',![]),$(_0x341cd2(0x117))[_0x341cd2(0x12c)](_0x341cd2(0x12e),![]),arrFileFolder=[];});}function getFilesFromLibrary(_0x1ff00c){var _0x3faf5b=a0_0x2935,_0xfef631=_0x1ff00c+_0x3faf5b(0x11f);$[_0x3faf5b(0x139)]({'url':_0xfef631,'type':_0x3faf5b(0x112),'headers':{'Accept':_0x3faf5b(0x121)},'beforeSend':function(){var _0x2076a0=_0x3faf5b;$(_0x2076a0(0x113))[_0x2076a0(0x124)]();},'success':function(_0x5ab8d2){var _0x3df026=_0x3faf5b,_0x104ab8=_0x5ab8d2['d']['results'],_0x22e6e5=[];_0x104ab8[_0x3df026(0x13b)](function(_0x30e85e){var _0x50cac1=_0x3df026,_0x12b349=_0x30e85e[_0x50cac1(0x10a)]['substring'](_0x30e85e[_0x50cac1(0x10a)]['lastIndexOf']('/')+0x1),_0x33626a={'name':_0x12b349,'url':_0x30e85e[_0x50cac1(0x10a)],'checkbox':_0x50cac1(0x133)+_0x30e85e[_0x50cac1(0x10a)]+'\x27>'};_0x22e6e5[_0x50cac1(0xf5)](_0x33626a);});var _0x46d8c7=_0x3df026(0xf1);_0x46d8c7+='<tr><th>Select</th><th>Name</th></tr>',_0x22e6e5[_0x3df026(0x13b)](function(_0x309de4){var _0x4447e0=_0x3df026;_0x46d8c7+=_0x4447e0(0x11d)+_0x309de4[_0x4447e0(0x12d)]+'</td><td>'+_0x309de4[_0x4447e0(0xf2)]+_0x4447e0(0xe6);}),_0x46d8c7+=_0x3df026(0x118),$(_0x3df026(0x10c))[_0x3df026(0x101)](_0x46d8c7);},'error':function(_0x3e242e){console['log'](_0x3e242e);}});}function getFolderFilesAndSubFolders(_0x9cc556,_0x279e1f){var _0x1929cc=a0_0x2935,_0x1f7ad5=SiteUrl+_0x1929cc(0x107)+_0x9cc556+_0x1929cc(0x115);return jQuery[_0x1929cc(0x139)]({'url':_0x1f7ad5,'type':_0x1929cc(0x112),'async':![],'headers':{'accept':_0x1929cc(0x121)},'beforeSend':function(){},'success':function(_0x4f2965){var _0x41d9bd=_0x1929cc,_0xcb90b5=parseBasePermissionss(_0x4f2965['d'][_0x41d9bd(0x123)]['EffectiveBasePermissions']);if(_0xcb90b5!=![]){var _0x1c84c7=_0x4f2965['d'][_0x41d9bd(0xe9)][_0x41d9bd(0x11c)];_0x1c84c7[_0x41d9bd(0x13b)](function(_0x3afc15){var _0xb51583=_0x41d9bd;parseBasePermissionss(_0x3afc15[_0xb51583(0x123)]['EffectiveBasePermissions'])!=![]?_0x279e1f['push'](_0x3afc15[_0xb51583(0x127)]):IsleftRestritcfile=!![];});var _0x478a4f=_0x4f2965['d'][_0x41d9bd(0x10e)][_0x41d9bd(0x11c)],_0x3b6c97=_0x478a4f['map'](function(_0x532cc5){var _0x5b202d=_0x41d9bd;getFolderFilesAndSubFolders(_0x532cc5[_0x5b202d(0x127)],_0x279e1f);});}else IsleftRestritcfile=!![];},'error':function(_0x5867af){console['log'](_0x5867af);}}),_0x279e1f;}function parseBasePermissionss(_0x2b85b5){var _0x30b9a6=a0_0x2935,_0x5f5af1=new SP[(_0x30b9a6(0x10f))]();return _0x5f5af1['initPropertiesFromJson'](_0x2b85b5),_0x5f5af1['has'](SP[_0x30b9a6(0x12a)][_0x30b9a6(0x13e)]);}var Isnotpermission=![];function checkFilePermission(_0x40d5fe){var _0x4e4410=a0_0x2935;Isnotpermission=![];var _0x3be55c=SiteUrl+_0x4e4410(0x12b)+_0x40d5fe+'\x27)?$select=ID,EncodedAbsUrl,File_x0020_Type&$expand=Folders,Folders/ListItemAllFields/HasUniqueRoleAssignments,Files/ModifiedBy/Title,Files/ListItemAllFields/HasUniqueRoleAssignments,Folders/ListItemAllFields,Files,Files/ListItemAllFields,Files/ListItemAllFields/FileSizeDisplay&$orderby=Modified\x20desc';return $[_0x4e4410(0x139)]({'url':_0x3be55c,'type':_0x4e4410(0x112),'async':![],'headers':{'accept':_0x4e4410(0x121)},'success':function(_0x204518){debugger;},'error':function(_0x2c9ade){var _0x3ee216=_0x4e4410;console[_0x3ee216(0xec)]('Error\x20checking\x20file\x20permissions:\x20'+JSON[_0x3ee216(0xe5)](_0x2c9ade));}}),Isnotpermission;}function retrieveAllItemsFromFolder(_0xcce6f6,_0x2c6608){var _0xb8ffe4=a0_0x2935,_0x313b7f=$[_0xb8ffe4(0xef)](),_0x9c46f7=[];_0x37ef85(_0xcce6f6,_0x2c6608,null,_0x9c46f7);function _0x37ef85(_0x5813cb,_0xcb335,_0x1e0e2c,_0x30843d){var _0x21ff24=_0xb8ffe4,_0x49efc7=_spPageContextInfo[_0x21ff24(0x126)]+_0x21ff24(0x136)+_0x5813cb+_0x21ff24(0x12f);_0xcb335&&(_0x49efc7+=_0x21ff24(0xeb)+_0xcb335+'\x27'),_0x1e0e2c&&(_0x49efc7+=_0x21ff24(0x108)+encodeURIComponent(_0x1e0e2c)),$[_0x21ff24(0x139)]({'url':_0x49efc7,'method':'GET','headers':{'Accept':_0x21ff24(0x109)},'success':function(_0x5e48ea){var _0x404647=_0x21ff24;_0x30843d=_0x30843d[_0x404647(0xf8)](_0x5e48ea['d'][_0x404647(0x11c)]);if(_0x5e48ea['d'][_0x404647(0xed)]){var _0x14b0ed=_0x5e48ea['d'][_0x404647(0xed)],_0x3d1d4f=_0x14b0ed[_0x404647(0xfc)](_0x14b0ed[_0x404647(0x128)](_0x404647(0x140))+0xa);_0x37ef85(_0x5813cb,_0xcb335,_0x3d1d4f,_0x30843d);}else _0x312648(_0x5813cb,_0xcb335,_0x30843d)[_0x404647(0x116)](function(_0x3b2a8c){var _0x279d0b=_0x404647;_0x313b7f[_0x279d0b(0x13a)](_0x3b2a8c);})[_0x404647(0xf7)](function(_0x5ea18d){var _0x46cf9a=_0x404647;_0x313b7f[_0x46cf9a(0x13c)](_0x5ea18d);});},'error':function(_0x1440a0){var _0x59b75e=_0x21ff24;_0x313b7f[_0x59b75e(0x13c)](_0x1440a0);}});}function _0x312648(_0x37f5de,_0x942234,_0xbdfb2){var _0x37601b=_0xb8ffe4,_0x1d1556=$[_0x37601b(0xef)](),_0x315e27=_spPageContextInfo[_0x37601b(0x126)]+_0x37601b(0x136)+_0x37f5de+_0x37601b(0x111)+_0x942234+_0x37601b(0x11b);return $[_0x37601b(0x139)]({'url':_0x315e27,'method':_0x37601b(0x112),'headers':{'Accept':_0x37601b(0x109)},'success':function(_0x20f0f6){var _0x280ce0=_0x37601b,_0x592cc4=_0x20f0f6['d'][_0x280ce0(0x11c)],_0x1e6af8=$['map'](_0x592cc4,function(_0x23e639){var _0xd3c573=_0x280ce0,_0x73ba37=_0x23e639[_0xd3c573(0x127)];return _0x37ef85(_0x37f5de,_0x73ba37,null,_0xbdfb2);});$[_0x280ce0(0x142)][_0x280ce0(0xfd)]($,_0x1e6af8)[_0x280ce0(0x10b)](function(){var _0xfce763=_0x280ce0,_0x118d67=[];for(var _0x4b8515=0x0;_0x4b8515<arguments[_0xfce763(0x13d)];_0x4b8515++){_0x118d67=_0x118d67['concat'](arguments[_0x4b8515]);}var _0x188bb8=_0xbdfb2[_0xfce763(0xf8)](_0x118d67);_0x1d1556[_0xfce763(0x13a)](_0x188bb8);})['fail'](function(_0x2c2f02){var _0x1b9b68=_0x280ce0;_0x1d1556[_0x1b9b68(0x13c)](_0x2c2f02);});},'error':function(_0x186ade){var _0x561f2f=_0x37601b;_0x1d1556[_0x561f2f(0x13c)](_0x186ade);}}),_0x1d1556[_0x37601b(0xee)]();}return _0x313b7f[_0xb8ffe4(0xee)]();}